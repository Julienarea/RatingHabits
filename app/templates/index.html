<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Профиль</title>
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="{{ url_for('static', filename='css/style.css') }}"
        />
    </head>
    <body>
        <header class="header">
            <h1>ПРОФИЛЬ</h1>
            <a href="{{ url_for('logout') }}" style="position: absolute; right: 24px; top: 24px; color: #fff; text-decoration: none; font-size: 14px; padding: 8px 16px; background: rgba(255,255,255,0.2); border-radius: 8px; transition: background 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">Выйти</a>
        </header>

        <main class="container">
            <section class="avatar block card">
                <img src="{{ user.avatar }}" alt="Аватар" class="avatar-img" />
                <div class="nickname">{{ user.nickname }}</div>
            </section>

            <section class="rating block card">
                <div class="rating-title">
                    <span>Рейтинг</span>
                </div>
                <div class="rating-value">{{ user.rating }}</div>
                <div class="rating-bar">
                    <div
                        class="rating-bar-fill"
                        style="width: {{ user.rating/20 }}%;"
                    ></div>
                </div>
            </section>

            <section class="achievements block card">
                <div class="section-title">
                    <img
                        src="https://cdn-icons-png.flaticon.com/512/1828/1828884.png"
                        class="icon"
                    />
                    Достижения
                </div>
                <ul class="achievements-list">
                    {% for ach in user.achievements %}
                    <li class="achievement-item">
                        <span class="achievement-title">{{ ach.title }}</span>
                        <span class="achievement-desc"
                            >{{ ach.description }}</span
                        >
                    </li>
                    {% endfor %}
                </ul>
            </section>

            <section class="tasks block card">
                <div class="card-head">
                    <div class="section-title">Задачи</div>
                    <button class="icon-btn" id="add-task-btn">
                        <img
                            src="https://cdn-icons-png.flaticon.com/512/1828/1828919.png"
                            class="icon"
                            alt="Кнопка"
                        />
                    </button>
                </div>
                <div class = "card-filters">
                    <div class="filter active" data-filter="active">Активные</div>
                    <div class="filter" data-filter="completed">Сделанные</div>
                </div>
                <ul class="tasks-list">
                    {% for task in user.tasks %}
                    <li class="task-item" data-status="{{ task.status }}">
                        <label class="checkbox-container">
                            <input type="checkbox" class="task-checkbox" {% if
                            task.status == 'completed' %}checked{% endif %}
                            data-task-id="{{ task.id }}" 
                            data-task-title="{{ task.title }}" >
                            <span class="checkmark"></span>
                            <span class="task-title">{{ task.title }}</span>
                        </label>
                    </li>
                    {% endfor %}
                </ul>
            </section>

            <section class="habits block card">
                <div class="card-head">
                    <div class="section-title">Привычки</div>
                    <button class="icon-btn">
                        <img
                            src="https://cdn-icons-png.flaticon.com/512/1828/1828919.png"
                            class="icon"
                            alt="Кнопка"
                        />
                    </button>
                </div>
                <div class = "card-filters">
                    <div class="filter" data-filter="all">Все</div>
                    <div class="filter active" data-filter="active">Активные</div>
                    <div class="filter" data-filter="completed">Сделанные</div>
                </div>
                <ul class="habits-list">
                    {% for habit in user.habits %}
                    <li class="habit-item" data-status="{% if habit.streak > 0 %}completed{% else %}in_progress{% endif %}">
                        <label class="checkbox-container">
                            <input type="checkbox" class="habit-checkbox" {% if habit.streak > 0 %}checked{% endif %} 
                                data-habit-id="{{ habit.id }}"
                                data-habit-title="{{ habit.title }}">
                            <span class="checkmark"></span>
                            <span class="habit-title">{{ habit.title }}</span>
                            <span class="habit-streak">(Серия: {{ habit.streak }})</span>
                        </label>
                    </li>
                    {% endfor %}
                </ul>
            </section>
        </main>

        <footer class="footer">
            <span>ЮНИТ.УРФУ</span>
        </footer>

        <!-- Overlay и модальные окна -->
        <div
            id="modal-overlay"
            class="modal-overlay"
            style="display: none"
        ></div>
        <div id="modal-task" class="modal" style="display: none">
            <div class="modal-content">
                <h2>Создать задачу</h2>
                <input
                    type="text"
                    id="task-title"
                    placeholder="Название задачи"
                />
                <div class="modal-actions">
                    <button id="task-create-btn" class="modal-btn">
                        Создать
                    </button>
                    <button id="task-cancel-btn" class="modal-btn cancel">
                        Отмена
                    </button>
                </div>
            </div>
        </div>
        <div id="modal-habit" class="modal" style="display: none">
            <div class="modal-content">
                <h2>Создать привычку</h2>
                <input
                    type="text"
                    id="habit-title"
                    placeholder="Название привычки"
                />
                <div class="modal-actions">
                    <button id="habit-create-btn" class="modal-btn">
                        Создать
                    </button>
                    <button id="habit-cancel-btn" class="modal-btn cancel">
                        Отмена
                    </button>
                </div>
            </div>
        </div>
        <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    </body>
</html>
